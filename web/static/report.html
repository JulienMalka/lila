<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/static/echarts.min.js"></script>
  <!-- TODO perhaps replace -->
  <script src="/static/jquery.min.js "></script>
  <link rel="stylesheet" href="/styles/index.css">
  <style>
    body {
      padding: 3em;
    }
  </style>
</head>
<body>
  <h1>Reproducibility report</h1>
  <p>
  This is an report based on the experimental
  <a href="https://github.com/JulienMalka/lila">lila</a>
  hash collection infrastructure for NixOS. The graph below shows whether hashes
  collected from independent rebuilders agree. Paths are divided into five categories:
  <ul>
    <li><b>No builds:</b> no builders provided a hash for this path. Populating the report
      might still be in progress, or <a href="https://github.com/JulienMalka/lila/issues/39">#39</a>
    <li><b>One build:</b> this path appeared only once. Populating the report
      might still be in progress, or <a href="https://github.com/JulienMalka/lila/issues/40">#40</a>
    <li><b>Partially reproduced:</b> some but, not all, builders agreed on the hash. At this point this likely just means the build is nondeterministic, but it might be good to double-check for malicious builds.
    <li><b>Successfully reproduced:</b> several builders reported the same hash.
    <li><b>Consistently nondeterministic:</b> no builders agreed on the hash. The build is likely nondeterministic.
  </ul>
  </p>

  <div id="main" style="width: 100%; height: 800"></div>
  <script>
var option;
const myChart = echarts.init(document.getElementById('main'))
myChart.showLoading();
myChart.showLoading();
$.get(document.location.pathname + '/graph-data.json', function (webkitDep) {
  console.log('loaded', webkitDep);
  myChart.hideLoading();
  option = {
    color: webkitDep.color,
    legend: {
      data: webkitDep.legend
    },
    series: [
      {
        type: 'graph',
        layout: 'force',
        edgeSymbol: ['circle', 'arrow'],
        animation: true,
        label: {
          position: 'right',
          formatter: '{b}'
        },
        draggable: true,
        data: webkitDep.nodes.map(function (node, idx) {
          node.id = idx;
          node.value = 1;
          return node;
        }),
        categories: webkitDep.categories,
        // a bit overwhelming - can we add a delay?
        //emphasis: {
        //  focus: 'adjacency'
        //},
        force: {
          edgeLength: 5,
          repulsion: 20,
          gravity: 0.2
        },
        edges: webkitDep.links
      }
    ]
  };
  myChart.on('click', function(params) {
    if (params.dataType == 'node') {
      alert(params.name);
    }
  });
  myChart.setOption(option);
});
  </script>
</body>
</html>
